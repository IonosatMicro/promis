FROM richarvey/nginx-nodejs

# Do this first to benefit from cache
RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app
ADD my-react-app/package.json /usr/src/app/
RUN npm config set registry https://registry.npmjs.org/
RUN npm install 

# This doesn't contain any replacements
ADD nginx.conf /etc/nginx/

# Configs generated by deploy
ADD deploy/promis.conf /etc/nginx/
ADD deploy/promis_api.yaml /var/www/promis/api/

#RUN chgrp nginx /etc/ssl/private
#RUN chmod g+x,g+r /etc/ssl/private

# Add the actual app
ADD run_web_promis.sh /
ADD my-react-app /usr/src/app

# The original image uses supervisord to start up
# Skipping their logic and just running our stuff
CMD [ "/run_web_promis.sh" ]
